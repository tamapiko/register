document.addEventListener("DOMContentLoaded", function() {
    var productModal = document.getElementById("product-modal");
    var registerProductBtn = document.getElementById("register-product");
    var addProductBtn = document.getElementById("add-product");
    var closeBtn = document.getElementsByClassName("close")[0];
    var cartItems = document.getElementById("cart-items");
    var totalPriceElement = document.getElementById("total-price");
    var totalQuantityElement = document.getElementById("total-quantity");
    var paymentElement = document.getElementById("payment");
    var changeElement = document.getElementById("change");

    registerProductBtn.onclick = function() {
        productModal.style.display = "block";
    }

    closeBtn.onclick = function() {
        productModal.style.display = "none";
    }

    window.onclick = function(event) {
        if (event.target == productModal) {
            productModal.style.display = "none";
        }
    }

    addProductBtn.onclick = function() {
        var barcode = document.getElementById("barcode").value;
        var productName = document.getElementById("product-name").value;
        var price = parseInt(document.getElementById("price").value);

        if (barcode && productName && price) {
            var product = document.createElement("div");
            product.classList.add("product");
            product.innerHTML = `
                <div class="product-name">${productName}</div>
                <div class="product-quantity">
                    <button class="quantity-btn" data-action="decrease">-</button>
                    <span>1個</span>
                    <button class="quantity-btn" data-action="increase">+</button>
                </div>
                <div class="product-price">¥${price}</div>
            `;

            cartItems.appendChild(product);
            updateSummary();

            productModal.style.display = "none";
        }
    }

    function updateSummary() {
        var products = cartItems.getElementsByClassName("product");
        var totalQuantity = 0;
        var totalPrice = 0;

        for (var i = 0; i < products.length; i++) {
            var quantityElement = products[i].querySelector(".product-quantity span");
            var priceElement = products[i].querySelector(".product-price");

            var quantity = parseInt(quantityElement.textContent);
            var price = parseInt(priceElement.textContent.replace("¥", ""));

            totalQuantity += quantity;
            totalPrice += quantity * price;
        }

        totalPriceElement.textContent = `¥${totalPrice}`;
        totalQuantityElement.textContent = `${totalQuantity}点`;
        paymentElement.textContent = `¥${totalPrice}`;
        changeElement.textContent = `¥0`; // 支払い額は手動で入力するか、後で変更可能
    }
});
